"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.WrathAndGloryActorSheet = void 0;
const dialog_js_1 = require("../common/dialog.js");
const roll_js_1 = require("../common/roll.js");
class WrathAndGloryActorSheet extends ActorSheet {
    constructor() {
        super(...arguments);
        this.rollData = {};
    }
    getData() {
        const data = super.getData();
        data.data = data.data.data; // project system data so that handlebars has the same name and value paths
        return data;
    }
    activateListeners(html) {
        super.activateListeners(html);
        html.find(".item-create").click((ev) => this._onItemCreate(ev));
        html.find(".item-edit").click((ev) => this._onItemEdit(ev));
        html.find(".item-delete").click((ev) => this._onItemDelete(ev));
        html.find("input").focusin((ev) => this._onFocusIn(ev));
        html.find(".roll-attribute").click(async (ev) => await this._prepareRollAttribute(ev));
        html.find(".roll-skill").click(async (ev) => await this._prepareRollSkill(ev));
        html.find(".roll-stealth").click(async (ev) => await this._prepareRollStealthScore(ev));
        html.find(".roll-determination").click(async (ev) => await this._prepareRollDetermination(ev));
        html.find(".roll-conviction").click(async (ev) => await this._prepareRollConviction(ev));
        html.find(".roll-resolve").click(async (ev) => await this._prepareRollResolve(ev));
        html.find(".roll-influence").click(async (ev) => await this._prepareRollInfluence(ev));
        html.find(".roll-weapon").click(async (ev) => await this._prepareRollWeapon(ev));
        html.find(".roll-psychic-power").click(async (ev) => await this._prepareRollPsychicPower(ev));
    }
    _getHeaderButtons() {
        let buttons = super._getHeaderButtons();
        if (this.actor.isOwner) {
            buttons = [
                {
                    label: game.i18n.localize("BUTTON.ROLL"),
                    class: "custom-roll",
                    icon: "fas fa-dice",
                    onclick: async (ev) => await this._prepareCustomRoll()
                },
                {
                    label: game.i18n.localize("BUTTON.REROLL"),
                    class: "reroll",
                    icon: "fas fa-redo",
                    onclick: async (ev) => await this._prepareReroll()
                },
                {
                    label: game.i18n.localize("BUTTON.DAMAGE"),
                    class: "damage",
                    icon: "fas fa-tint",
                    onclick: async (ev) => await this._prepareDamageRoll()
                }
            ].concat(buttons);
        }
        return buttons;
    }
    _onItemCreate(event) {
        event.preventDefault();
        let header = event.currentTarget.dataset;
        let data = {
            name: `New ${game.i18n.localize("ITEM.Type" + header.type.toLowerCase().capitalize())}`,
            type: header.type
        };
        this.actor.createEmbeddedDocuments("Item", [data], { renderSheet: true });
    }
    _onItemEdit(event) {
        event.preventDefault();
        const div = $(event.currentTarget).parents(".item");
        const item = this.actor.items.get(div.data("itemId"));
        item.sheet.render(true);
    }
    _onItemDelete(event) {
        event.preventDefault();
        const div = $(event.currentTarget).parents(".item");
        this.actor.deleteEmbeddedDocuments("Item", [div.data("itemId")]);
        div.slideUp(200, () => this.render(false));
    }
    _onFocusIn(event) {
        $(event.currentTarget).select();
    }
    async _prepareCustomRoll() {
        this._resetRollData();
        await dialog_js_1.prepareCommonRoll(this.rollData);
    }
    async _prepareReroll() {
        await roll_js_1.reroll(this.rollData);
    }
    async _prepareDamageRoll() {
        this._resetRollData();
        this.rollData.weapon = {
            damage: {
                base: 0,
                rank: "none",
                bonus: 0
            },
            ed: {
                base: 0,
                rank: "none",
                bonus: 0,
                die: {
                    one: 0,
                    two: 0,
                    three: 0,
                    four: 1,
                    five: 1,
                    six: 2
                }
            },
            ap: {
                base: 0,
                rank: "none",
                bonus: 0
            },
            traits: ""
        };
        this.rollData.name = "ROLL.DAMAGE";
        await dialog_js_1.prepareDamageRoll(this.rollData);
    }
    async _prepareRollAttribute(event) {
        event.preventDefault();
        this._resetRollData();
        const attributeName = $(event.currentTarget).data("attribute");
        const attribute = this.actor.attributes[attributeName];
        this.rollData.name = attribute.label;
        this.rollData.pool.size = attribute.total;
        await dialog_js_1.prepareCommonRoll(this.rollData);
    }
    async _prepareRollSkill(event) {
        event.preventDefault();
        this._resetRollData();
        const skillName = $(event.currentTarget).data("skill");
        const skill = this.actor.skills[skillName];
        this.rollData.name = skill.label;
        this.rollData.pool.size = skill.total;
        await dialog_js_1.prepareCommonRoll(this.rollData);
    }
    async _prepareRollStealthScore(event) {
        event.preventDefault();
        this._resetRollData();
        const skill = this.actor.skills.stealth;
        this.rollData.name = skill.label;
        this.rollData.difficulty.target = 0;
        this.rollData.pool.size = skill.total;
        await dialog_js_1.prepareCommonRoll(this.rollData);
    }
    async _prepareRollDetermination(event) {
        event.preventDefault();
        this._resetRollData();
        this.rollData.name = "ROLL.DETERMINATION";
        this.rollData.pool.size = this.actor.combat.determination.total;
        await dialog_js_1.prepareCommonRoll(this.rollData);
    }
    async _prepareRollConviction(event) {
        event.preventDefault();
        this._resetRollData();
        this.rollData.name = "ROLL.CONVICTION";
        this.rollData.pool.size = this.actor.corruption.conviction;
        this.rollData.difficulty.penalty = this._getConvictionPenalty();
        await dialog_js_1.prepareCommonRoll(this.rollData);
    }
    async _prepareRollResolve(event) {
        event.preventDefault();
        this._resetRollData();
        this.rollData.name = "ROLL.RESOLVE";
        this.rollData.pool.size = this.actor.combat.resolve.total;
        await dialog_js_1.prepareCommonRoll(this.rollData);
    }
    async _prepareRollInfluence(event) {
        event.preventDefault();
        this._resetRollData();
        this.rollData.name = "ROLL.INFLUENCE";
        this.rollData.pool.size = this.actor.resources.influence;
        await dialog_js_1.prepareCommonRoll(this.rollData);
    }
    async _prepareRollWeapon(event) {
        event.preventDefault();
        this._resetRollData();
        const div = $(event.currentTarget).parents(".item");
        const weapon = this.actor.items.get(div.data("itemId"));
        let skill;
        this.rollData.weapon = {
            damage: {
                base: weapon.damage.base,
                rank: weapon.damage.rank,
                bonus: weapon.damage.bonus
            },
            ed: {
                base: weapon.ed.base,
                rank: weapon.ed.rank,
                bonus: weapon.ed.bonus,
                die: weapon.ed.die
            },
            ap: {
                base: weapon.ap.base,
                rank: weapon.ap.rank,
                bonus: weapon.ap.bonus
            },
            traits: weapon.traits
        };
        if (weapon.category === "melee") {
            skill = this.actor.skills.weaponSkill;
            let strength = this.actor.attributes.strength;
            this.rollData.weapon.damage.bonus = strength.total;
        }
        else {
            skill = this.actor.skills.ballisticSkill;
        }
        this.rollData.wrath.isWeapon = true;
        this.rollData.wrath.isCommon = false;
        this.rollData.skillName = skill.label;
        this.rollData.name = weapon.data.name;
        this.rollData.pool.size = skill.total;
        this.rollData.pool.bonus = weapon.attack.base + weapon.attack.bonus;
        this.rollData.pool.rank = weapon.attack.rank;
        await dialog_js_1.prepareWeaponRoll(this.rollData);
    }
    async _prepareRollPsychicPower(event) {
        event.preventDefault();
        this._resetRollData();
        const div = $(event.currentTarget).parents(".item");
        const psychicPower = this.actor.items.get(div.data("itemId"));
        const skill = this.actor.skills.psychicMastery;
        this.rollData.difficulty.target = psychicPower.dn;
        this.rollData.name = psychicPower.data.name;
        this.rollData.weapon = {
            damage: {
                base: psychicPower.damage.base,
                rank: psychicPower.damage.rank,
                bonus: psychicPower.damage.bonus
            },
            ed: {
                base: psychicPower.ed.base,
                rank: psychicPower.ed.rank,
                bonus: psychicPower.ed.bonus,
                die: psychicPower.ed.die
            },
            potency: psychicPower.potency
        };
        this.rollData.wrath.isPsy = true;
        this.rollData.wrath.isCommon = false;
        this.rollData.pool.size = skill.total;
        this.rollData.skillName = skill.label;
        this.rollData.name = psychicPower.data.name;
        await dialog_js_1.preparePsychicRoll(this.rollData);
    }
    _resetRollData() {
        let rank = 0;
        if (this.actor.advances) {
            rank = this.actor.advances.rank;
        }
        this.rollData = {
            name: "DIALOG.CUSTOM_ROLL",
            rank: rank,
            difficulty: {
                target: 3,
                penalty: 0,
                rank: "none"
            },
            pool: {
                size: 1,
                bonus: 0,
                rank: "none"
            },
            wrath: {
                base: 1,
                isPsy: false,
                isCommon: true,
                isWeapon: false
            },
            result: {
                dice: [],
                wrath: 0,
                isSuccess: false,
                isWrathCritical: false,
                isWrathComplication: false
            },
            rolls: {
                hit: [],
                damage: []
            }
        };
    }
    _getConvictionPenalty() {
        let corruption = this.actor.corruption.current;
        if (corruption > 20) {
            return 4;
        }
        else if (corruption > 15) {
            return 3;
        }
        else if (corruption > 10) {
            return 2;
        }
        else if (corruption > 5) {
            return 1;
        }
        else {
            return 0;
        }
    }
}
exports.WrathAndGloryActorSheet = WrathAndGloryActorSheet;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0b3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2hlZXQvYWN0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsbURBQWtIO0FBQ2xILCtDQUEyQztBQUczQyxNQUFhLHVCQUF3QixTQUFRLFVBQVU7SUFBdkQ7O1FBQ0ksYUFBUSxHQUFhLEVBQVMsQ0FBQztJQXVUbkMsQ0FBQztJQXJURyxPQUFPO1FBQ0gsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQzdCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUEsQ0FBQywyRUFBMkU7UUFDdEcsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUdELGlCQUFpQixDQUFDLElBQVU7UUFDeEIsS0FBSyxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBUyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDdkUsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFTLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNuRSxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQVMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3ZFLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBUyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDL0Qs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QUFNLEVBQUUsRUFBRTthQUNiO1NBQ0csQ0FBQztJQUNiLENBQUM7SUFFRCxxQkFBcUI7UUFDakIsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDO1FBQy9DLElBQUksVUFBVSxHQUFHLEVBQUUsRUFBRTtZQUNqQixPQUFPLENBQUMsQ0FBQztTQUNaO2FBQU0sSUFBSSxVQUFVLEdBQUcsRUFBRSxFQUFFO1lBQ3hCLE9BQU8sQ0FBQyxDQUFDO1NBQ1o7YUFBTSxJQUFJLFVBQVUsR0FBRyxFQUFFLEVBQUU7WUFDeEIsT0FBTyxDQUFDLENBQUM7U0FDWjthQUFNLElBQUksVUFBVSxHQUFHLENBQUMsRUFBRTtZQUN2QixPQUFPLENBQUMsQ0FBQztTQUNaO2FBQU07WUFDSCxPQUFPLENBQUMsQ0FBQztTQUNaO0lBQ0wsQ0FBQztDQUNKO0FBeFRELDBEQXdUQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHByZXBhcmVDb21tb25Sb2xsLCBwcmVwYXJlV2VhcG9uUm9sbCwgcHJlcGFyZURhbWFnZVJvbGwsIHByZXBhcmVQc3ljaGljUm9sbCB9IGZyb20gXCIuLi9jb21tb24vZGlhbG9nLmpzXCI7XG5pbXBvcnQgeyByZXJvbGwgfSBmcm9tIFwiLi4vY29tbW9uL3JvbGwuanNcIjtcbmltcG9ydCB7SHRtbCwgUm9sbERhdGF9IGZyb20gXCIuLi90eXBlc1wiO1xuXG5leHBvcnQgY2xhc3MgV3JhdGhBbmRHbG9yeUFjdG9yU2hlZXQgZXh0ZW5kcyBBY3RvclNoZWV0IHtcbiAgICByb2xsRGF0YTogUm9sbERhdGEgPSB7fSBhcyBhbnk7XG5cbiAgICBnZXREYXRhKCkge1xuICAgICAgICBjb25zdCBkYXRhID0gc3VwZXIuZ2V0RGF0YSgpO1xuICAgICAgICBkYXRhLmRhdGEgPSBkYXRhLmRhdGEuZGF0YSAvLyBwcm9qZWN0IHN5c3RlbSBkYXRhIHNvIHRoYXQgaGFuZGxlYmFycyBoYXMgdGhlIHNhbWUgbmFtZSBhbmQgdmFsdWUgcGF0aHNcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuICAgIFxuXG4gICAgYWN0aXZhdGVMaXN0ZW5lcnMoaHRtbDogSHRtbCkge1xuICAgICAgICBzdXBlci5hY3RpdmF0ZUxpc3RlbmVycyhodG1sKTtcbiAgICAgICAgaHRtbC5maW5kKFwiLml0ZW0tY3JlYXRlXCIpLmNsaWNrKChldjogRXZlbnQpID0+IHRoaXMuX29uSXRlbUNyZWF0ZShldikpO1xuICAgICAgICBodG1sLmZpbmQoXCIuaXRlbS1lZGl0XCIpLmNsaWNrKChldjogRXZlbnQpID0+IHRoaXMuX29uSXRlbUVkaXQoZXYpKTtcbiAgICAgICAgaHRtbC5maW5kKFwiLml0ZW0tZGVsZXRlXCIpLmNsaWNrKChldjogRXZlbnQpID0+IHRoaXMuX29uSXRlbURlbGV0ZShldikpO1xuICAgICAgICBodG1sLmZpbmQoXCJpbnB1dFwiKS5mb2N1c2luKChldjogRXZlbnQpID0+IHRoaXMuX29uRm9jdXNJbihldikpO1xuICAgICAgICBodG1sLmZpbmQoXCIucm9sbC1hdHRyaWJ1dGVcIikuY2xpY2soYXN5bmMgKGV2OiBFdmVudCkgPT4gYXdhaXQgdGhpcy5fcHJlcGFyZVJvbGxBdHRyaWJ1dGUoZXYpKTtcbiAgICAgICAgaHRtbC5maW5kKFwiLnJvbGwtc2tpbGxcIikuY2xpY2soYXN5bmMgKGV2OiBFdmVudCkgPT4gYXdhaXQgdGhpcy5fcHJlcGFyZVJvbGxTa2lsbChldikpO1xuICAgICAgICBodG1sLmZpbmQoXCIucm9sbC1zdGVhbHRoXCIpLmNsaWNrKGFzeW5jIChldjogRXZlbnQpID0+IGF3YWl0IHRoaXMuX3ByZXBhcmVSb2xsU3RlYWx0aFNjb3JlKGV2KSk7XG4gICAgICAgIGh0bWwuZmluZChcIi5yb2xsLWRldGVybWluYXRpb25cIikuY2xpY2soYXN5bmMgKGV2OiBFdmVudCkgPT4gYXdhaXQgdGhpcy5fcHJlcGFyZVJvbGxEZXRlcm1pbmF0aW9uKGV2KSk7XG4gICAgICAgIGh0bWwuZmluZChcIi5yb2xsLWNvbnZpY3Rpb25cIikuY2xpY2soYXN5bmMgKGV2OiBFdmVudCkgPT4gYXdhaXQgdGhpcy5fcHJlcGFyZVJvbGxDb252aWN0aW9uKGV2KSk7XG4gICAgICAgIGh0bWwuZmluZChcIi5yb2xsLXJlc29sdmVcIikuY2xpY2soYXN5bmMgKGV2OiBFdmVudCkgPT4gYXdhaXQgdGhpcy5fcHJlcGFyZVJvbGxSZXNvbHZlKGV2KSk7XG4gICAgICAgIGh0bWwuZmluZChcIi5yb2xsLWluZmx1ZW5jZVwiKS5jbGljayhhc3luYyAoZXY6IEV2ZW50KSA9PiBhd2FpdCB0aGlzLl9wcmVwYXJlUm9sbEluZmx1ZW5jZShldikpO1xuICAgICAgICBodG1sLmZpbmQoXCIucm9sbC13ZWFwb25cIikuY2xpY2soYXN5bmMgKGV2OiBFdmVudCkgPT4gYXdhaXQgdGhpcy5fcHJlcGFyZVJvbGxXZWFwb24oZXYpKTtcbiAgICAgICAgaHRtbC5maW5kKFwiLnJvbGwtcHN5Y2hpYy1wb3dlclwiKS5jbGljayhhc3luYyAoZXY6IEV2ZW50KSA9PiBhd2FpdCB0aGlzLl9wcmVwYXJlUm9sbFBzeWNoaWNQb3dlcihldikpO1xuXG4gICAgfVxuXG4gICAgX2dldEhlYWRlckJ1dHRvbnMoKSB7XG4gICAgICAgIGxldCBidXR0b25zID0gc3VwZXIuX2dldEhlYWRlckJ1dHRvbnMoKTtcbiAgICAgICAgaWYgKHRoaXMuYWN0b3IuaXNPd25lcikge1xuICAgICAgICAgICAgYnV0dG9ucyA9IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBnYW1lLmkxOG4ubG9jYWxpemUoXCJCVVRUT04uUk9MTFwiKSxcbiAgICAgICAgICAgICAgICAgICAgY2xhc3M6IFwiY3VzdG9tLXJvbGxcIixcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogXCJmYXMgZmEtZGljZVwiLFxuICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOiBhc3luYyAoZXY6IEV2ZW50KSA9PiBhd2FpdCB0aGlzLl9wcmVwYXJlQ3VzdG9tUm9sbCgpXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBnYW1lLmkxOG4ubG9jYWxpemUoXCJCVVRUT04uUkVST0xMXCIpLFxuICAgICAgICAgICAgICAgICAgICBjbGFzczogXCJyZXJvbGxcIixcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogXCJmYXMgZmEtcmVkb1wiLFxuICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOiBhc3luYyAoZXY6IEV2ZW50KSA9PiBhd2FpdCB0aGlzLl9wcmVwYXJlUmVyb2xsKClcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGdhbWUuaTE4bi5sb2NhbGl6ZShcIkJVVFRPTi5EQU1BR0VcIiksXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzOiBcImRhbWFnZVwiLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiBcImZhcyBmYS10aW50XCIsXG4gICAgICAgICAgICAgICAgICAgIG9uY2xpY2s6IGFzeW5jIChldjogRXZlbnQpID0+IGF3YWl0IHRoaXMuX3ByZXBhcmVEYW1hZ2VSb2xsKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdLmNvbmNhdChidXR0b25zKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYnV0dG9ucztcbiAgICB9XG5cbiAgICBfb25JdGVtQ3JlYXRlKGV2ZW50OiBFdmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBsZXQgaGVhZGVyID0gZXZlbnQuY3VycmVudFRhcmdldC5kYXRhc2V0XG4gICAgICAgIFxuICAgICAgICBsZXQgZGF0YSA9IHtcbiAgICAgICAgICAgICBuYW1lIDogYE5ldyAke2dhbWUuaTE4bi5sb2NhbGl6ZShcIklURU0uVHlwZVwiICsgaGVhZGVyLnR5cGUudG9Mb3dlckNhc2UoKS5jYXBpdGFsaXplKCkpfWAsXG4gICAgICAgICAgICAgdHlwZSA6IGhlYWRlci50eXBlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuYWN0b3IuY3JlYXRlRW1iZWRkZWREb2N1bWVudHMoXCJJdGVtXCIsIFtkYXRhXSwgeyByZW5kZXJTaGVldDogdHJ1ZSB9KTtcbiAgICB9XG5cbiAgICBfb25JdGVtRWRpdChldmVudDogRXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc3QgZGl2ID0gJChldmVudC5jdXJyZW50VGFyZ2V0KS5wYXJlbnRzKFwiLml0ZW1cIik7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmFjdG9yLml0ZW1zLmdldChkaXYuZGF0YShcIml0ZW1JZFwiKSk7XG4gICAgICAgIGl0ZW0uc2hlZXQucmVuZGVyKHRydWUpO1xuICAgIH1cblxuICAgIF9vbkl0ZW1EZWxldGUoZXZlbnQ6IEV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnN0IGRpdiA9ICQoZXZlbnQuY3VycmVudFRhcmdldCkucGFyZW50cyhcIi5pdGVtXCIpO1xuICAgICAgICB0aGlzLmFjdG9yLmRlbGV0ZUVtYmVkZGVkRG9jdW1lbnRzKFwiSXRlbVwiLCBbZGl2LmRhdGEoXCJpdGVtSWRcIildKTtcbiAgICAgICAgZGl2LnNsaWRlVXAoMjAwLCAoKSA9PiB0aGlzLnJlbmRlcihmYWxzZSkpO1xuICAgIH1cblxuICAgIF9vbkZvY3VzSW4oZXZlbnQ6IEV2ZW50KSB7XG4gICAgICAgICQoZXZlbnQuY3VycmVudFRhcmdldCkuc2VsZWN0KCk7XG4gICAgfVxuXG4gICAgYXN5bmMgX3ByZXBhcmVDdXN0b21Sb2xsKCkge1xuICAgICAgICB0aGlzLl9yZXNldFJvbGxEYXRhKCk7XG4gICAgICAgIGF3YWl0IHByZXBhcmVDb21tb25Sb2xsKHRoaXMucm9sbERhdGEgYXMgUm9sbERhdGEpO1xuICAgIH1cblxuICAgIGFzeW5jIF9wcmVwYXJlUmVyb2xsKCkge1xuICAgICAgICBhd2FpdCByZXJvbGwodGhpcy5yb2xsRGF0YSBhcyBSb2xsRGF0YSk7XG4gICAgfVxuXG4gICAgYXN5bmMgX3ByZXBhcmVEYW1hZ2VSb2xsKCkge1xuICAgICAgICB0aGlzLl9yZXNldFJvbGxEYXRhKCk7XG4gICAgICAgIHRoaXMucm9sbERhdGEud2VhcG9uID0ge1xuICAgICAgICAgICAgZGFtYWdlOiB7XG4gICAgICAgICAgICAgICAgYmFzZTogMCxcbiAgICAgICAgICAgICAgICByYW5rOiBcIm5vbmVcIixcbiAgICAgICAgICAgICAgICBib251czogMFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVkOiB7XG4gICAgICAgICAgICAgICAgYmFzZTogMCxcbiAgICAgICAgICAgICAgICByYW5rOiBcIm5vbmVcIixcbiAgICAgICAgICAgICAgICBib251czogMCxcbiAgICAgICAgICAgICAgICBkaWU6IHtcbiAgICAgICAgICAgICAgICAgICAgb25lOiAwLFxuICAgICAgICAgICAgICAgICAgICB0d286IDAsXG4gICAgICAgICAgICAgICAgICAgIHRocmVlOiAwLFxuICAgICAgICAgICAgICAgICAgICBmb3VyOiAxLFxuICAgICAgICAgICAgICAgICAgICBmaXZlOiAxLFxuICAgICAgICAgICAgICAgICAgICBzaXg6IDJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXA6IHtcbiAgICAgICAgICAgICAgICBiYXNlOiAwLFxuICAgICAgICAgICAgICAgIHJhbms6IFwibm9uZVwiLFxuICAgICAgICAgICAgICAgIGJvbnVzOiAwXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdHJhaXRzOiBcIlwiXG4gICAgICAgIH0gYXMgYW55XG4gICAgICAgIHRoaXMucm9sbERhdGEubmFtZSA9IFwiUk9MTC5EQU1BR0VcIjtcbiAgICAgICAgYXdhaXQgcHJlcGFyZURhbWFnZVJvbGwodGhpcy5yb2xsRGF0YSBhcyBSb2xsRGF0YSk7XG4gICAgfVxuXG4gICAgYXN5bmMgX3ByZXBhcmVSb2xsQXR0cmlidXRlKGV2ZW50OiBFdmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLl9yZXNldFJvbGxEYXRhKCk7XG4gICAgICAgIGNvbnN0IGF0dHJpYnV0ZU5hbWUgPSAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmRhdGEoXCJhdHRyaWJ1dGVcIik7XG4gICAgICAgIGNvbnN0IGF0dHJpYnV0ZSA9IHRoaXMuYWN0b3IuYXR0cmlidXRlc1thdHRyaWJ1dGVOYW1lXTtcbiAgICAgICAgdGhpcy5yb2xsRGF0YS5uYW1lID0gYXR0cmlidXRlLmxhYmVsO1xuICAgICAgICB0aGlzLnJvbGxEYXRhLnBvb2wuc2l6ZSA9IGF0dHJpYnV0ZS50b3RhbDtcbiAgICAgICAgYXdhaXQgcHJlcGFyZUNvbW1vblJvbGwodGhpcy5yb2xsRGF0YSk7XG4gICAgfVxuXG4gICAgYXN5bmMgX3ByZXBhcmVSb2xsU2tpbGwoZXZlbnQ6IEV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMuX3Jlc2V0Um9sbERhdGEoKTtcbiAgICAgICAgY29uc3Qgc2tpbGxOYW1lID0gJChldmVudC5jdXJyZW50VGFyZ2V0KS5kYXRhKFwic2tpbGxcIik7XG4gICAgICAgIGNvbnN0IHNraWxsID0gdGhpcy5hY3Rvci5za2lsbHNbc2tpbGxOYW1lXTtcbiAgICAgICAgdGhpcy5yb2xsRGF0YS5uYW1lID0gc2tpbGwubGFiZWw7XG4gICAgICAgIHRoaXMucm9sbERhdGEucG9vbC5zaXplID0gc2tpbGwudG90YWw7XG4gICAgICAgIGF3YWl0IHByZXBhcmVDb21tb25Sb2xsKHRoaXMucm9sbERhdGEpO1xuICAgIH1cblxuICAgIGFzeW5jIF9wcmVwYXJlUm9sbFN0ZWFsdGhTY29yZShldmVudDogRXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5fcmVzZXRSb2xsRGF0YSgpO1xuICAgICAgICBjb25zdCBza2lsbCA9IHRoaXMuYWN0b3Iuc2tpbGxzLnN0ZWFsdGg7XG4gICAgICAgIHRoaXMucm9sbERhdGEubmFtZSA9IHNraWxsLmxhYmVsO1xuICAgICAgICB0aGlzLnJvbGxEYXRhLmRpZmZpY3VsdHkudGFyZ2V0ID0gMDtcbiAgICAgICAgdGhpcy5yb2xsRGF0YS5wb29sLnNpemUgPSBza2lsbC50b3RhbDtcbiAgICAgICAgYXdhaXQgcHJlcGFyZUNvbW1vblJvbGwodGhpcy5yb2xsRGF0YSk7XG4gICAgfVxuXG4gICAgYXN5bmMgX3ByZXBhcmVSb2xsRGV0ZXJtaW5hdGlvbihldmVudDogRXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5fcmVzZXRSb2xsRGF0YSgpO1xuICAgICAgICB0aGlzLnJvbGxEYXRhLm5hbWUgPSBcIlJPTEwuREVURVJNSU5BVElPTlwiO1xuICAgICAgICB0aGlzLnJvbGxEYXRhLnBvb2wuc2l6ZSA9IHRoaXMuYWN0b3IuY29tYmF0LmRldGVybWluYXRpb24udG90YWw7XG4gICAgICAgIGF3YWl0IHByZXBhcmVDb21tb25Sb2xsKHRoaXMucm9sbERhdGEpO1xuICAgIH1cblxuICAgIGFzeW5jIF9wcmVwYXJlUm9sbENvbnZpY3Rpb24oZXZlbnQ6IEV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMuX3Jlc2V0Um9sbERhdGEoKTtcbiAgICAgICAgdGhpcy5yb2xsRGF0YS5uYW1lID0gXCJST0xMLkNPTlZJQ1RJT05cIjtcbiAgICAgICAgdGhpcy5yb2xsRGF0YS5wb29sLnNpemUgPSB0aGlzLmFjdG9yLmNvcnJ1cHRpb24uY29udmljdGlvbjtcbiAgICAgICAgdGhpcy5yb2xsRGF0YS5kaWZmaWN1bHR5LnBlbmFsdHkgPSB0aGlzLl9nZXRDb252aWN0aW9uUGVuYWx0eSgpO1xuICAgICAgICBhd2FpdCBwcmVwYXJlQ29tbW9uUm9sbCh0aGlzLnJvbGxEYXRhKTtcbiAgICB9XG5cbiAgICBhc3luYyBfcHJlcGFyZVJvbGxSZXNvbHZlKGV2ZW50OiBFdmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLl9yZXNldFJvbGxEYXRhKCk7XG4gICAgICAgIHRoaXMucm9sbERhdGEubmFtZSA9IFwiUk9MTC5SRVNPTFZFXCI7XG4gICAgICAgIHRoaXMucm9sbERhdGEucG9vbC5zaXplID0gdGhpcy5hY3Rvci5jb21iYXQucmVzb2x2ZS50b3RhbDtcbiAgICAgICAgYXdhaXQgcHJlcGFyZUNvbW1vblJvbGwodGhpcy5yb2xsRGF0YSk7XG4gICAgfVxuXG4gICAgYXN5bmMgX3ByZXBhcmVSb2xsSW5mbHVlbmNlKGV2ZW50OiBFdmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLl9yZXNldFJvbGxEYXRhKCk7XG4gICAgICAgIHRoaXMucm9sbERhdGEubmFtZSA9IFwiUk9MTC5JTkZMVUVOQ0VcIjtcbiAgICAgICAgdGhpcy5yb2xsRGF0YS5wb29sLnNpemUgPSB0aGlzLmFjdG9yLnJlc291cmNlcy5pbmZsdWVuY2U7XG4gICAgICAgIGF3YWl0IHByZXBhcmVDb21tb25Sb2xsKHRoaXMucm9sbERhdGEpO1xuICAgIH1cblxuICAgIGFzeW5jIF9wcmVwYXJlUm9sbFdlYXBvbihldmVudDogRXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5fcmVzZXRSb2xsRGF0YSgpO1xuICAgICAgICBjb25zdCBkaXYgPSAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLnBhcmVudHMoXCIuaXRlbVwiKTtcbiAgICAgICAgY29uc3Qgd2VhcG9uID0gdGhpcy5hY3Rvci5pdGVtcy5nZXQoZGl2LmRhdGEoXCJpdGVtSWRcIikpO1xuICAgICAgICBsZXQgc2tpbGw7XG4gICAgICAgIHRoaXMucm9sbERhdGEud2VhcG9uID0ge1xuICAgICAgICAgICAgZGFtYWdlOiB7XG4gICAgICAgICAgICAgICAgYmFzZTogd2VhcG9uLmRhbWFnZS5iYXNlLFxuICAgICAgICAgICAgICAgIHJhbms6IHdlYXBvbi5kYW1hZ2UucmFuayxcbiAgICAgICAgICAgICAgICBib251czogd2VhcG9uLmRhbWFnZS5ib251c1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVkOiB7XG4gICAgICAgICAgICAgICAgYmFzZTogd2VhcG9uLmVkLmJhc2UsXG4gICAgICAgICAgICAgICAgcmFuazogd2VhcG9uLmVkLnJhbmssXG4gICAgICAgICAgICAgICAgYm9udXM6IHdlYXBvbi5lZC5ib251cyxcbiAgICAgICAgICAgICAgICBkaWU6IHdlYXBvbi5lZC5kaWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhcDoge1xuICAgICAgICAgICAgICAgIGJhc2U6IHdlYXBvbi5hcC5iYXNlLFxuICAgICAgICAgICAgICAgIHJhbms6IHdlYXBvbi5hcC5yYW5rLFxuICAgICAgICAgICAgICAgIGJvbnVzOiB3ZWFwb24uYXAuYm9udXNcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0cmFpdHM6IHdlYXBvbi50cmFpdHNcbiAgICAgICAgfSBhcyBhbnk7XG4gICAgICAgIGlmICh3ZWFwb24uY2F0ZWdvcnkgPT09IFwibWVsZWVcIikge1xuICAgICAgICAgICAgc2tpbGwgPSB0aGlzLmFjdG9yLnNraWxscy53ZWFwb25Ta2lsbDtcbiAgICAgICAgICAgIGxldCBzdHJlbmd0aCA9IHRoaXMuYWN0b3IuYXR0cmlidXRlcy5zdHJlbmd0aDtcbiAgICAgICAgICAgIHRoaXMucm9sbERhdGEud2VhcG9uLmRhbWFnZS5ib251cyA9IHN0cmVuZ3RoLnRvdGFsO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2tpbGwgPSB0aGlzLmFjdG9yLnNraWxscy5iYWxsaXN0aWNTa2lsbDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJvbGxEYXRhLndyYXRoLmlzV2VhcG9uID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5yb2xsRGF0YS53cmF0aC5pc0NvbW1vbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJvbGxEYXRhLnNraWxsTmFtZSA9IHNraWxsLmxhYmVsO1xuICAgICAgICB0aGlzLnJvbGxEYXRhLm5hbWUgPSB3ZWFwb24uZGF0YS5uYW1lO1xuICAgICAgICB0aGlzLnJvbGxEYXRhLnBvb2wuc2l6ZSA9IHNraWxsLnRvdGFsO1xuICAgICAgICB0aGlzLnJvbGxEYXRhLnBvb2wuYm9udXMgPSB3ZWFwb24uYXR0YWNrLmJhc2UgKyB3ZWFwb24uYXR0YWNrLmJvbnVzO1xuICAgICAgICB0aGlzLnJvbGxEYXRhLnBvb2wucmFuayA9IHdlYXBvbi5hdHRhY2sucmFuaztcbiAgICAgICAgYXdhaXQgcHJlcGFyZVdlYXBvblJvbGwodGhpcy5yb2xsRGF0YSk7XG4gICAgfVxuXG4gICAgYXN5bmMgX3ByZXBhcmVSb2xsUHN5Y2hpY1Bvd2VyKGV2ZW50OiBFdmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB0aGlzLl9yZXNldFJvbGxEYXRhKCk7XG4gICAgICAgIGNvbnN0IGRpdiA9ICQoZXZlbnQuY3VycmVudFRhcmdldCkucGFyZW50cyhcIi5pdGVtXCIpO1xuICAgICAgICBjb25zdCBwc3ljaGljUG93ZXIgPSB0aGlzLmFjdG9yLml0ZW1zLmdldChkaXYuZGF0YShcIml0ZW1JZFwiKSk7XG4gICAgICAgIGNvbnN0IHNraWxsID0gdGhpcy5hY3Rvci5za2lsbHMucHN5Y2hpY01hc3Rlcnk7XG4gICAgICAgIHRoaXMucm9sbERhdGEuZGlmZmljdWx0eS50YXJnZXQgPSBwc3ljaGljUG93ZXIuZG47XG4gICAgICAgIHRoaXMucm9sbERhdGEubmFtZSA9IHBzeWNoaWNQb3dlci5kYXRhLm5hbWU7XG4gICAgICAgIHRoaXMucm9sbERhdGEud2VhcG9uID0ge1xuICAgICAgICAgICAgZGFtYWdlOiB7XG4gICAgICAgICAgICAgICAgYmFzZTogcHN5Y2hpY1Bvd2VyLmRhbWFnZS5iYXNlLFxuICAgICAgICAgICAgICAgIHJhbms6IHBzeWNoaWNQb3dlci5kYW1hZ2UucmFuayxcbiAgICAgICAgICAgICAgICBib251czogcHN5Y2hpY1Bvd2VyLmRhbWFnZS5ib251c1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVkOiB7XG4gICAgICAgICAgICAgICAgYmFzZTogcHN5Y2hpY1Bvd2VyLmVkLmJhc2UsXG4gICAgICAgICAgICAgICAgcmFuazogcHN5Y2hpY1Bvd2VyLmVkLnJhbmssXG4gICAgICAgICAgICAgICAgYm9udXM6IHBzeWNoaWNQb3dlci5lZC5ib251cyxcbiAgICAgICAgICAgICAgICBkaWU6IHBzeWNoaWNQb3dlci5lZC5kaWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwb3RlbmN5OiBwc3ljaGljUG93ZXIucG90ZW5jeVxuICAgICAgICB9IGFzIGFueTtcbiAgICAgICAgdGhpcy5yb2xsRGF0YS53cmF0aC5pc1BzeSA9IHRydWU7XG4gICAgICAgIHRoaXMucm9sbERhdGEud3JhdGguaXNDb21tb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yb2xsRGF0YS5wb29sLnNpemUgPSBza2lsbC50b3RhbDtcbiAgICAgICAgdGhpcy5yb2xsRGF0YS5za2lsbE5hbWUgPSBza2lsbC5sYWJlbDtcbiAgICAgICAgdGhpcy5yb2xsRGF0YS5uYW1lID0gcHN5Y2hpY1Bvd2VyLmRhdGEubmFtZTtcbiAgICAgICAgYXdhaXQgcHJlcGFyZVBzeWNoaWNSb2xsKHRoaXMucm9sbERhdGEpO1xuICAgIH1cblxuICAgIF9yZXNldFJvbGxEYXRhKCkge1xuICAgICAgICBsZXQgcmFuayA9IDA7XG4gICAgICAgIGlmICh0aGlzLmFjdG9yLmFkdmFuY2VzKSB7XG4gICAgICAgICAgICByYW5rID0gdGhpcy5hY3Rvci5hZHZhbmNlcy5yYW5rO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucm9sbERhdGEgPSB7XG4gICAgICAgICAgICBuYW1lOiBcIkRJQUxPRy5DVVNUT01fUk9MTFwiLFxuICAgICAgICAgICAgcmFuazogcmFuayxcbiAgICAgICAgICAgIGRpZmZpY3VsdHk6IHtcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IDMsXG4gICAgICAgICAgICAgICAgcGVuYWx0eTogMCxcbiAgICAgICAgICAgICAgICByYW5rOiBcIm5vbmVcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBvb2w6IHtcbiAgICAgICAgICAgICAgICBzaXplOiAxLFxuICAgICAgICAgICAgICAgIGJvbnVzOiAwLFxuICAgICAgICAgICAgICAgIHJhbms6IFwibm9uZVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgd3JhdGg6IHtcbiAgICAgICAgICAgICAgICBiYXNlOiAxLFxuICAgICAgICAgICAgICAgIGlzUHN5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICBpc0NvbW1vbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpc1dlYXBvbjogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXN1bHQ6IHtcbiAgICAgICAgICAgICAgICBkaWNlOiBbXSxcbiAgICAgICAgICAgICAgICB3cmF0aDogMCxcbiAgICAgICAgICAgICAgICBpc1N1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlzV3JhdGhDcml0aWNhbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgaXNXcmF0aENvbXBsaWNhdGlvbjogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByb2xsczoge1xuICAgICAgICAgICAgICAgIGhpdDogW10sXG4gICAgICAgICAgICAgICAgZGFtYWdlOiBbXVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGFzIGFueTtcbiAgICB9XG5cbiAgICBfZ2V0Q29udmljdGlvblBlbmFsdHkoKSB7XG4gICAgICAgIGxldCBjb3JydXB0aW9uID0gdGhpcy5hY3Rvci5jb3JydXB0aW9uLmN1cnJlbnQ7XG4gICAgICAgIGlmIChjb3JydXB0aW9uID4gMjApIHtcbiAgICAgICAgICAgIHJldHVybiA0O1xuICAgICAgICB9IGVsc2UgaWYgKGNvcnJ1cHRpb24gPiAxNSkge1xuICAgICAgICAgICAgcmV0dXJuIDM7XG4gICAgICAgIH0gZWxzZSBpZiAoY29ycnVwdGlvbiA+IDEwKSB7XG4gICAgICAgICAgICByZXR1cm4gMjtcbiAgICAgICAgfSBlbHNlIGlmIChjb3JydXB0aW9uID4gNSkge1xuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgIH1cbn0iXX0=