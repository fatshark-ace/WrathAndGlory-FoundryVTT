"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.prepareDamageRoll = exports.prepareWeaponRoll = exports.preparePsychicRoll = exports.prepareCommonRoll = void 0;
const roll_js_1 = require("./roll.js");
async function prepareCommonRoll(rollData) {
    const html = await renderTemplate("systems/wrath-and-glory/template/dialog/common-roll.html", rollData);
    let dialog = new Dialog({
        title: game.i18n.localize(rollData.name),
        content: html,
        buttons: {
            cancel: {
                icon: '<i class="fas fa-times"></i>',
                label: game.i18n.localize("BUTTON.CANCEL"),
                callback: () => { },
            },
            roll: {
                icon: '<i class="fas fa-check"></i>',
                label: game.i18n.localize("BUTTON.ROLL"),
                callback: async (html) => {
                    rollData.name = game.i18n.localize(rollData.name);
                    rollData.difficulty.target = parseInt(html.find("#difficulty-target")[0].value, 10);
                    rollData.difficulty.penalty = parseInt(html.find("#difficulty-penalty")[0].value, 10);
                    rollData.difficulty.penalty -= getRank(rollData, html.find("#difficulty-rank")[0].value);
                    rollData.pool.size = parseInt(html.find("#pool-size")[0].value, 10);
                    rollData.pool.bonus = parseInt(html.find("#pool-bonus")[0].value, 10);
                    rollData.pool.bonus += getRank(rollData, html.find("#pool-rank")[0].value);
                    await roll_js_1.commonRoll(rollData);
                },
            }
        },
        default: "roll",
        close: () => { },
    }, { width: 260 });
    dialog.render(true);
}
exports.prepareCommonRoll = prepareCommonRoll;
async function preparePsychicRoll(rollData) {
    const html = await renderTemplate("systems/wrath-and-glory/template/dialog/psychic-roll.html", rollData);
    let dialog = new Dialog({
        title: rollData.name,
        content: html,
        buttons: {
            cancel: {
                icon: '<i class="fas fa-times"></i>',
                label: game.i18n.localize("BUTTON.CANCEL"),
                callback: () => { },
            },
            roll: {
                icon: '<i class="fas fa-check"></i>',
                label: game.i18n.localize("BUTTON.ROLL"),
                callback: async (html) => {
                    rollData.name = rollData.name;
                    rollData.difficulty.target = parseInt(html.find("#difficulty-target")[0].value, 10);
                    rollData.difficulty.penalty = parseInt(html.find("#difficulty-penalty")[0].value, 10);
                    rollData.difficulty.penalty -= getRank(rollData, html.find("#difficulty-rank")[0].value);
                    rollData.pool.size = parseInt(html.find("#pool-size")[0].value, 10);
                    rollData.pool.bonus = parseInt(html.find("#pool-bonus")[0].value, 10);
                    rollData.pool.bonus += getRank(rollData, html.find("#pool-rank")[0].value);
                    rollData.wrath.base = parseInt(html.find("#wrath-base")[0].value, 10);
                    rollData.weapon.damage.base = parseInt(html.find("#damage-base")[0].value, 10);
                    rollData.weapon.damage.bonus = parseInt(html.find("#damage-bonus")[0].value, 10);
                    rollData.weapon.damage.bonus += getRank(rollData, html.find("#damage-rank")[0].value);
                    rollData.weapon.ed.base = parseInt(html.find("#ed-base")[0].value, 10);
                    rollData.weapon.ed.bonus = parseInt(html.find("#ed-bonus")[0].value, 10);
                    rollData.weapon.ed.bonus += getRank(rollData, html.find("#ed-rank")[0].value);
                    rollData.weapon.ed.die.one = parseInt(html.find("#die-one")[0].value, 10);
                    rollData.weapon.ed.die.two = parseInt(html.find("#die-two")[0].value, 10);
                    rollData.weapon.ed.die.three = parseInt(html.find("#die-three")[0].value, 10);
                    rollData.weapon.ed.die.four = parseInt(html.find("#die-four")[0].value, 10);
                    rollData.weapon.ed.die.five = parseInt(html.find("#die-five")[0].value, 10);
                    rollData.weapon.ed.die.six = parseInt(html.find("#die-six")[0].value, 10);
                    rollData.weapon.potency = html.find("#potency")[0].value;
                    await roll_js_1.psychicRoll(rollData);
                },
            }
        },
        default: "roll",
        close: () => { },
    }, { width: 500 });
    dialog.render(true);
}
exports.preparePsychicRoll = preparePsychicRoll;
async function prepareWeaponRoll(rollData) {
    rollData.difficulty.target = _getTargetDefense();
    const html = await renderTemplate("systems/wrath-and-glory/template/dialog/weapon-roll.html", rollData);
    let dialog = new Dialog({
        title: rollData.name,
        content: html,
        buttons: {
            cancel: {
                icon: '<i class="fas fa-times"></i>',
                label: game.i18n.localize("BUTTON.CANCEL"),
                callback: () => { },
            },
            roll: {
                icon: '<i class="fas fa-check"></i>',
                label: game.i18n.localize("BUTTON.ROLL"),
                callback: async (html) => {
                    rollData.name = rollData.name;
                    rollData.difficulty.target = parseInt(html.find("#difficulty-target")[0].value, 10);
                    rollData.difficulty.penalty = parseInt(html.find("#difficulty-penalty")[0].value, 10);
                    rollData.difficulty.penalty -= getRank(rollData, html.find("#difficulty-rank")[0].value);
                    rollData.pool.size = parseInt(html.find("#pool-size")[0].value, 10);
                    rollData.pool.bonus = parseInt(html.find("#pool-bonus")[0].value, 10);
                    rollData.pool.bonus += getRank(rollData, html.find("#pool-rank")[0].value);
                    rollData.weapon.damage.base = parseInt(html.find("#damage-base")[0].value, 10);
                    rollData.weapon.damage.bonus = parseInt(html.find("#damage-bonus")[0].value, 10);
                    rollData.weapon.damage.bonus += getRank(rollData, html.find("#damage-rank")[0].value);
                    rollData.weapon.ed.base = parseInt(html.find("#ed-base")[0].value, 10);
                    rollData.weapon.ed.bonus = parseInt(html.find("#ed-bonus")[0].value, 10);
                    rollData.weapon.ed.bonus += getRank(rollData, html.find("#ed-rank")[0].value);
                    rollData.weapon.ap.base = parseInt(html.find("#ap-base")[0].value, 10);
                    rollData.weapon.ap.bonus = parseInt(html.find("#ap-bonus")[0].value, 10);
                    rollData.weapon.ap.bonus += getRank(rollData, html.find("#ap-rank")[0].value);
                    rollData.weapon.traits = html.find("#traits")[0].value;
                    rollData.weapon.ed.die.one = parseInt(html.find("#die-one")[0].value, 10);
                    rollData.weapon.ed.die.two = parseInt(html.find("#die-two")[0].value, 10);
                    rollData.weapon.ed.die.three = parseInt(html.find("#die-three")[0].value, 10);
                    rollData.weapon.ed.die.four = parseInt(html.find("#die-four")[0].value, 10);
                    rollData.weapon.ed.die.five = parseInt(html.find("#die-five")[0].value, 10);
                    rollData.weapon.ed.die.six = parseInt(html.find("#die-six")[0].value, 10);
                    await roll_js_1.weaponRoll(rollData);
                },
            }
        },
        default: "roll",
        close: () => { },
    }, { width: 500 });
    dialog.render(true);
}
exports.prepareWeaponRoll = prepareWeaponRoll;
async function prepareDamageRoll(rollData) {
    const html = await renderTemplate("systems/wrath-and-glory/template/dialog/damage-roll.html", rollData);
    let dialog = new Dialog({
        title: rollData.name,
        content: html,
        buttons: {
            cancel: {
                icon: '<i class="fas fa-times"></i>',
                label: game.i18n.localize("BUTTON.CANCEL"),
                callback: () => { },
            },
            roll: {
                icon: '<i class="fas fa-check"></i>',
                label: game.i18n.localize("BUTTON.ROLL"),
                callback: async (html) => {
                    rollData.name = game.i18n.localize(rollData.name);
                    rollData.weapon.damage.base = parseInt(html.find("#damage-base")[0].value, 10);
                    rollData.weapon.damage.bonus = parseInt(html.find("#damage-bonus")[0].value, 10);
                    rollData.weapon.damage.bonus += getRank(rollData, html.find("#damage-rank")[0].value);
                    rollData.weapon.ed.base = parseInt(html.find("#ed-base")[0].value, 10);
                    rollData.weapon.ed.bonus = parseInt(html.find("#damage-bonus")[0].value, 10);
                    rollData.weapon.ed.bonus += getRank(rollData, html.find("#damage-rank")[0].value);
                    rollData.weapon.ap.base = parseInt(html.find("#ap-base")[0].value, 10);
                    rollData.weapon.ap.bonus = parseInt(html.find("#ap-bonus")[0].value, 10);
                    rollData.weapon.ap.bonus += getRank(rollData, html.find("#ap-rank")[0].value);
                    rollData.weapon.traits = html.find("#traits")[0].value;
                    await roll_js_1.damageRoll(rollData);
                },
            }
        },
        default: "roll",
        close: () => { },
    }, { width: 260 });
    dialog.render(true);
}
exports.prepareDamageRoll = prepareDamageRoll;
function _getTargetDefense(combat) {
    const target = game.user.targets.values().next().value;
    if (target === undefined) {
        return 3;
    }
    else {
        return target.actor.combat.defense.total;
    }
}
function getRank(rollData, rank) {
    switch (rank) {
        case "none":
            return 0;
        case "single":
            return rollData.rank;
        case "double":
            return (rollData.rank * 2);
        case "minus-single":
            return rollData.rank;
        case "minus-double":
            return (rollData.rank * 2);
        default:
            return 0;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhbG9nLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NvbW1vbi9kaWFsb2cudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsdUNBQTRFO0FBR3JFLEtBQUssVUFBVSxpQkFBaUIsQ0FBQyxRQUFrQjtJQUN4RCxNQUFNLElBQUksR0FBRyxNQUFNLGNBQWMsQ0FBQywwREFBMEQsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN4RyxJQUFJLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQztRQUN0QixLQUFLLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztRQUN4QyxPQUFPLEVBQUUsSUFBSTtRQUNiLE9BQU8sRUFBRTtZQUNQLE1BQU0sRUFBRTtnQkFDTixJQUFJLEVBQUUsOEJBQThCO2dCQUNwQyxLQUFLLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDO2dCQUMxQyxRQUFRLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQzthQUNwQjtZQUNELElBQUksRUFBRTtnQkFDSixJQUFJLEVBQUUsOEJBQThCO2dCQUNwQyxLQUFLLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDO2dCQUN4QyxRQUFRLEVBQUUsS0FBSyxFQUFFLElBQVUsRUFBRSxFQUFFO29CQUM3QixRQUFRLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFDbEQsUUFBUSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7b0JBQ3BGLFFBQVEsQ0FBQyxVQUFVLENBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMs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QUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO29CQUN6RSxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUM5RSxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztvQkFDMUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7b0JBQzFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO29CQUM5RSxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztvQkFDNUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFD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QVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUMzRSxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO29CQUMvRSxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO29CQUNqRixRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUN0RixRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO29CQUN2RSxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO29CQUN6RSxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUM5RSxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO29CQUN2RSxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO29CQUN6RSxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUM5RSxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztvQkFDdkQsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7b0JBQzFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO29CQUMxRSxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsS0FBSyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztvQkFDOUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFD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SUFDckMsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUMsS0FBSyxDQUFDO0lBQ3ZELElBQUksTUFBTSxLQUFLLFNBQVMsRUFBRTtRQUN4QixPQUFPLENBQUMsQ0FBQztLQUNWO1NBQU07UUFDTCxPQUFPLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUM7S0FDMUM7QUFDSCxDQUFDO0FBRUQsU0FBUyxPQUFPLENBQUMsUUFBa0IsRUFBRSxJQUFZO0lBQy9DLFFBQVEsSUFBSSxFQUFFO1FBQ1osS0FBSyxNQUFNO1lBQ1QsT0FBTyxDQUFDLENBQUM7UUFDWCxLQUFLLFFBQVE7WUFDWCxPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUM7UUFDdkIsS0FBSyxRQUFRO1lBQ1gsT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDM0IsS0FBSyxjQUFjO1lBQ25CLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQztRQUN2QixLQUFLLGNBQWM7WUFDakIsT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDN0I7WUFDRSxPQUFPLENBQUMsQ0FBQztLQUNaO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvbW1vblJvbGwsIHdlYXBvblJvbGwsIGRhbWFnZVJvbGwsIHBzeWNoaWNSb2xsIH0gZnJvbSBcIi4vcm9sbC5qc1wiO1xuaW1wb3J0IHtIdG1sLCBSb2xsRGF0YX0gZnJvbSBcIi4uL3R5cGVzXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcmVwYXJlQ29tbW9uUm9sbChyb2xsRGF0YTogUm9sbERhdGEpIHtcbiAgY29uc3QgaHRtbCA9IGF3YWl0IHJlbmRlclRlbXBsYXRlKFwic3lzdGVtcy93cmF0aC1hbmQtZ2xvcnkvdGVtcGxhdGUvZGlhbG9nL2NvbW1vbi1yb2xsLmh0bWxcIiwgcm9sbERhdGEpO1xuICBsZXQgZGlhbG9nID0gbmV3IERpYWxvZyh7XG4gICAgdGl0bGU6IGdhbWUuaTE4bi5sb2NhbGl6ZShyb2xsRGF0YS5uYW1lKSxcbiAgICBjb250ZW50OiBodG1sLFxuICAgIGJ1dHRvbnM6IHtcbiAgICAgIGNhbmNlbDoge1xuICAgICAgICBpY29uOiAnPGkgY2xhc3M9XCJmYXMgZmEtdGltZXNcIj48L2k+JyxcbiAgICAgICAgbGFiZWw6IGdhbWUuaTE4bi5sb2NhbGl6ZShcIkJVVFRPTi5DQU5DRUxcIiksXG4gICAgICAgIGNhbGxiYWNrOiAoKSA9PiB7IH0sXG4gICAgICB9LFxuICAgICAgcm9sbDoge1xuICAgICAgICBpY29uOiAnPGkgY2xhc3M9XCJmYXMgZmEtY2hlY2tcIj48L2k+JyxcbiAgICAgICAgbGFiZWw6IGdhbWUuaTE4bi5sb2NhbGl6ZShcIkJVVFRPTi5ST0xMXCIpLFxuICAgICAgICBjYWxsYmFjazogYXN5bmMgKGh0bWw6IEh0bWwpID0+IHtcbiAgICAgICAgICByb2xsRGF0YS5uYW1lID0gZ2FtZS5pMThuLmxvY2FsaXplKHJvbGxEYXRhLm5hbWUpO1xuICAgICAgICAgIHJvbGxEYXRhLmRpZmZpY3VsdHkudGFyZ2V0ID0gcGFyc2VJbnQoaHRtbC5maW5kKFwiI2RpZmZpY3VsdHktdGFyZ2V0XCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgcm9sbERhdGEuZGlmZmljdWx0eS5wZW5hbHR5ID0gcGFyc2VJbnQoaHRtbC5maW5kKFwiI2RpZmZpY3VsdHktcGVuYWx0eVwiKVswXS52YWx1ZSwgMTApO1xuICAgICAgICAgIHJvbGxEYXRhLmRpZmZpY3VsdHkucGVuYWx0eSAtPSBnZXRSYW5rKHJvbGxEYXRhLCBodG1sLmZpbmQoXCIjZGlmZmljdWx0eS1yYW5rXCIpWzBdLnZhbHVlKTtcbiAgICAgICAgICByb2xsRGF0YS5wb29sLnNpemUgPSBwYXJzZUludChodG1sLmZpbmQoXCIjcG9vbC1zaXplXCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgcm9sbERhdGEucG9vbC5ib251cyA9IHBhcnNlSW50KGh0bWwuZmluZChcIiNwb29sLWJvbnVzXCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgcm9sbERhdGEucG9vbC5ib251cyArPSBnZXRSYW5rKHJvbGxEYXRhLCBodG1sLmZpbmQoXCIjcG9vbC1yYW5rXCIpWzBdLnZhbHVlKTtcbiAgICAgICAgICBhd2FpdCBjb21tb25Sb2xsKHJvbGxEYXRhKTtcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICB9LFxuICAgIGRlZmF1bHQ6IFwicm9sbFwiLFxuICAgIGNsb3NlOiAoKSA9PiB7IH0sXG4gIH0sIHsgd2lkdGg6IDI2MCB9KTtcbiAgZGlhbG9nLnJlbmRlcih0cnVlKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByZXBhcmVQc3ljaGljUm9sbChyb2xsRGF0YTogUm9sbERhdGEpIHtcbiAgY29uc3QgaHRtbCA9IGF3YWl0IHJlbmRlclRlbXBsYXRlKFwic3lzdGVtcy93cmF0aC1hbmQtZ2xvcnkvdGVtcGxhdGUvZGlhbG9nL3BzeWNoaWMtcm9sbC5odG1sXCIsIHJvbGxEYXRhKTtcbiAgbGV0IGRpYWxvZyA9IG5ldyBEaWFsb2coe1xuICAgIHRpdGxlOiByb2xsRGF0YS5uYW1lLFxuICAgIGNvbnRlbnQ6IGh0bWwsXG4gICAgYnV0dG9uczoge1xuICAgICAgY2FuY2VsOiB7XG4gICAgICAgIGljb246ICc8aSBjbGFzcz1cImZhcyBmYS10aW1lc1wiPjwvaT4nLFxuICAgICAgICBsYWJlbDogZ2FtZS5pMThuLmxvY2FsaXplKFwiQlVUVE9OLkNBTkNFTFwiKSxcbiAgICAgICAgY2FsbGJhY2s6ICgpID0+IHsgfSxcbiAgICAgIH0sXG4gICAgICByb2xsOiB7XG4gICAgICAgIGljb246ICc8aSBjbGFzcz1cImZhcyBmYS1jaGVja1wiPjwvaT4nLFxuICAgICAgICBsYWJlbDogZ2FtZS5pMThuLmxvY2FsaXplKFwiQlVUVE9OLlJPTExcIiksXG4gICAgICAgIGNhbGxiYWNrOiBhc3luYyAoaHRtbDogSHRtbCkgPT4ge1xuICAgICAgICAgIHJvbGxEYXRhLm5hbWUgPSByb2xsRGF0YS5uYW1lO1xuICAgICAgICAgIHJvbGxEYXRhLmRpZmZpY3VsdHkudGFyZ2V0ID0gcGFyc2VJbnQoaHRtbC5maW5kKFwiI2RpZmZpY3VsdHktdGFyZ2V0XCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgcm9sbERhdGEuZGlmZmljdWx0eS5wZW5hbHR5ID0gcGFyc2VJbnQoaHRtbC5maW5kKFwiI2RpZmZpY3VsdHktcGVuYWx0eVwiKVswXS52YWx1ZSwgMTApO1xuICAgICAgICAgIHJvbGxEYXRhLmRpZmZpY3VsdHkucGVuYWx0eSAtPSBnZXRSYW5rKHJvbGxEYXRhLCBodG1sLmZpbmQoXCIjZGlmZmljdWx0eS1yYW5rXCIpWzBdLnZhbHVlKTtcbiAgICAgICAgICByb2xsRGF0YS5wb29sLnNpemUgPSBwYXJzZUludChodG1sLmZpbmQoXCIjcG9vbC1zaXplXCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgcm9sbERhdGEucG9vbC5ib251cyA9IHBhcnNlSW50KGh0bWwuZmluZChcIiNwb29sLWJvbnVzXCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgcm9sbERhdGEucG9vbC5ib251cyArPSBnZXRSYW5rKHJvbGxEYXRhLCBodG1sLmZpbmQoXCIjcG9vbC1yYW5rXCIpWzBdLnZhbHVlKTtcbiAgICAgICAgICByb2xsRGF0YS53cmF0aC5iYXNlID0gcGFyc2VJbnQoaHRtbC5maW5kKFwiI3dyYXRoLWJhc2VcIilbMF0udmFsdWUsIDEwKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uZGFtYWdlLmJhc2UgPSBwYXJzZUludChodG1sLmZpbmQoXCIjZGFtYWdlLWJhc2VcIilbMF0udmFsdWUsIDEwKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uZGFtYWdlLmJvbnVzID0gcGFyc2VJbnQoaHRtbC5maW5kKFwiI2RhbWFnZS1ib251c1wiKVswXS52YWx1ZSwgMTApO1xuICAgICAgICAgIHJvbGxEYXRhLndlYXBvbi5kYW1hZ2UuYm9udXMgKz0gZ2V0UmFuayhyb2xsRGF0YSwgaHRtbC5maW5kKFwiI2RhbWFnZS1yYW5rXCIpWzBdLnZhbHVlKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uZWQuYmFzZSA9IHBhcnNlSW50KGh0bWwuZmluZChcIiNlZC1iYXNlXCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgcm9sbERhdGEud2VhcG9uLmVkLmJvbnVzID0gcGFyc2VJbnQoaHRtbC5maW5kKFwiI2VkLWJvbnVzXCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgcm9sbERhdGEud2VhcG9uLmVkLmJvbnVzICs9IGdldFJhbmsocm9sbERhdGEsIGh0bWwuZmluZChcIiNlZC1yYW5rXCIpWzBdLnZhbHVlKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uZWQuZGllLm9uZSA9IHBhcnNlSW50KGh0bWwuZmluZChcIiNkaWUtb25lXCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgcm9sbERhdGEud2VhcG9uLmVkLmRpZS50d28gPSBwYXJzZUludChodG1sLmZpbmQoXCIjZGllLXR3b1wiKVswXS52YWx1ZSwgMTApO1xuICAgICAgICAgIHJvbGxEYXRhLndlYXBvbi5lZC5kaWUudGhyZWUgPSBwYXJzZUludChodG1sLmZpbmQoXCIjZGllLXRocmVlXCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgcm9sbERhdGEud2VhcG9uLmVkLmRpZS5mb3VyID0gcGFyc2VJbnQoaHRtbC5maW5kKFwiI2RpZS1mb3VyXCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgcm9sbERhdGEud2VhcG9uLmVkLmRpZS5maXZlID0gcGFyc2VJbnQoaHRtbC5maW5kKFwiI2RpZS1maXZlXCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgcm9sbERhdGEud2VhcG9uLmVkLmRpZS5zaXggPSBwYXJzZUludChodG1sLmZpbmQoXCIjZGllLXNpeFwiKVswXS52YWx1ZSwgMTApO1xuICAgICAgICAgIHJvbGxEYXRhLndlYXBvbi5wb3RlbmN5ID0gaHRtbC5maW5kKFwiI3BvdGVuY3lcIilbMF0udmFsdWU7XG4gICAgICAgICAgYXdhaXQgcHN5Y2hpY1JvbGwocm9sbERhdGEpO1xuICAgICAgICB9LFxuICAgICAgfVxuICAgIH0sXG4gICAgZGVmYXVsdDogXCJyb2xsXCIsXG4gICAgY2xvc2U6ICgpID0+IHsgfSxcbiAgfSwgeyB3aWR0aDogNTAwIH0pO1xuICBkaWFsb2cucmVuZGVyKHRydWUpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJlcGFyZVdlYXBvblJvbGwocm9sbERhdGE6IFJvbGxEYXRhKSB7XG4gIHJvbGxEYXRhLmRpZmZpY3VsdHkudGFyZ2V0ID0gX2dldFRhcmdldERlZmVuc2UoKTtcbiAgY29uc3QgaHRtbCA9IGF3YWl0IHJlbmRlclRlbXBsYXRlKFwic3lzdGVtcy93cmF0aC1hbmQtZ2xvcnkvdGVtcGxhdGUvZGlhbG9nL3dlYXBvbi1yb2xsLmh0bWxcIiwgcm9sbERhdGEpO1xuICBsZXQgZGlhbG9nID0gbmV3IERpYWxvZyh7XG4gICAgdGl0bGU6IHJvbGxEYXRhLm5hbWUsXG4gICAgY29udGVudDogaHRtbCxcbiAgICBidXR0b25zOiB7XG4gICAgICBjYW5jZWw6IHtcbiAgICAgICAgaWNvbjogJzxpIGNsYXNzPVwiZmFzIGZhLXRpbWVzXCI+PC9pPicsXG4gICAgICAgIGxhYmVsOiBnYW1lLmkxOG4ubG9jYWxpemUoXCJCVVRUT04uQ0FOQ0VMXCIpLFxuICAgICAgICBjYWxsYmFjazogKCkgPT4geyB9LFxuICAgICAgfSxcbiAgICAgIHJvbGw6IHtcbiAgICAgICAgaWNvbjogJzxpIGNsYXNzPVwiZmFzIGZhLWNoZWNrXCI+PC9pPicsXG4gICAgICAgIGxhYmVsOiBnYW1lLmkxOG4ubG9jYWxpemUoXCJCVVRUT04uUk9MTFwiKSxcbiAgICAgICAgY2FsbGJhY2s6IGFzeW5jIChodG1sOiBIdG1sKSA9PiB7XG4gICAgICAgICAgcm9sbERhdGEubmFtZSA9IHJvbGxEYXRhLm5hbWU7XG4gICAgICAgICAgcm9sbERhdGEuZGlmZmljdWx0eS50YXJnZXQgPSBwYXJzZUludChodG1sLmZpbmQoXCIjZGlmZmljdWx0eS10YXJnZXRcIilbMF0udmFsdWUsIDEwKTtcbiAgICAgICAgICByb2xsRGF0YS5kaWZmaWN1bHR5LnBlbmFsdHkgPSBwYXJzZUludChodG1sLmZpbmQoXCIjZGlmZmljdWx0eS1wZW5hbHR5XCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgcm9sbERhdGEuZGlmZmljdWx0eS5wZW5hbHR5IC09IGdldFJhbmsocm9sbERhdGEsIGh0bWwuZmluZChcIiNkaWZmaWN1bHR5LXJhbmtcIilbMF0udmFsdWUpO1xuICAgICAgICAgIHJvbGxEYXRhLnBvb2wuc2l6ZSA9IHBhcnNlSW50KGh0bWwuZmluZChcIiNwb29sLXNpemVcIilbMF0udmFsdWUsIDEwKTtcbiAgICAgICAgICByb2xsRGF0YS5wb29sLmJvbnVzID0gcGFyc2VJbnQoaHRtbC5maW5kKFwiI3Bvb2wtYm9udXNcIilbMF0udmFsdWUsIDEwKTtcbiAgICAgICAgICByb2xsRGF0YS5wb29sLmJvbnVzICs9IGdldFJhbmsocm9sbERhdGEsIGh0bWwuZmluZChcIiNwb29sLXJhbmtcIilbMF0udmFsdWUpO1xuICAgICAgICAgIHJvbGxEYXRhLndlYXBvbi5kYW1hZ2UuYmFzZSA9IHBhcnNlSW50KGh0bWwuZmluZChcIiNkYW1hZ2UtYmFzZVwiKVswXS52YWx1ZSwgMTApO1xuICAgICAgICAgIHJvbGxEYXRhLndlYXBvbi5kYW1hZ2UuYm9udXMgPSBwYXJzZUludChodG1sLmZpbmQoXCIjZGFtYWdlLWJvbnVzXCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgcm9sbERhdGEud2VhcG9uLmRhbWFnZS5ib251cyArPSBnZXRSYW5rKHJvbGxEYXRhLCBodG1sLmZpbmQoXCIjZGFtYWdlLXJhbmtcIilbMF0udmFsdWUpO1xuICAgICAgICAgIHJvbGxEYXRhLndlYXBvbi5lZC5iYXNlID0gcGFyc2VJbnQoaHRtbC5maW5kKFwiI2VkLWJhc2VcIilbMF0udmFsdWUsIDEwKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uZWQuYm9udXMgPSBwYXJzZUludChodG1sLmZpbmQoXCIjZWQtYm9udXNcIilbMF0udmFsdWUsIDEwKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uZWQuYm9udXMgKz0gZ2V0UmFuayhyb2xsRGF0YSwgaHRtbC5maW5kKFwiI2VkLXJhbmtcIilbMF0udmFsdWUpO1xuICAgICAgICAgIHJvbGxEYXRhLndlYXBvbi5hcC5iYXNlID0gcGFyc2VJbnQoaHRtbC5maW5kKFwiI2FwLWJhc2VcIilbMF0udmFsdWUsIDEwKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uYXAuYm9udXMgPSBwYXJzZUludChodG1sLmZpbmQoXCIjYXAtYm9udXNcIilbMF0udmFsdWUsIDEwKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uYXAuYm9udXMgKz0gZ2V0UmFuayhyb2xsRGF0YSwgaHRtbC5maW5kKFwiI2FwLXJhbmtcIilbMF0udmFsdWUpO1xuICAgICAgICAgIHJvbGxEYXRhLndlYXBvbi50cmFpdHMgPSBodG1sLmZpbmQoXCIjdHJhaXRzXCIpWzBdLnZhbHVlO1xuICAgICAgICAgIHJvbGxEYXRhLndlYXBvbi5lZC5kaWUub25lID0gcGFyc2VJbnQoaHRtbC5maW5kKFwiI2RpZS1vbmVcIilbMF0udmFsdWUsIDEwKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uZWQuZGllLnR3byA9IHBhcnNlSW50KGh0bWwuZmluZChcIiNkaWUtdHdvXCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgcm9sbERhdGEud2VhcG9uLmVkLmRpZS50aHJlZSA9IHBhcnNlSW50KGh0bWwuZmluZChcIiNkaWUtdGhyZWVcIilbMF0udmFsdWUsIDEwKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uZWQuZGllLmZvdXIgPSBwYXJzZUludChodG1sLmZpbmQoXCIjZGllLWZvdXJcIilbMF0udmFsdWUsIDEwKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uZWQuZGllLmZpdmUgPSBwYXJzZUludChodG1sLmZpbmQoXCIjZGllLWZpdmVcIilbMF0udmFsdWUsIDEwKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uZWQuZGllLnNpeCA9IHBhcnNlSW50KGh0bWwuZmluZChcIiNkaWUtc2l4XCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgYXdhaXQgd2VhcG9uUm9sbChyb2xsRGF0YSk7XG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgfSxcbiAgICBkZWZhdWx0OiBcInJvbGxcIixcbiAgICBjbG9zZTogKCkgPT4geyB9LFxuICB9LCB7IHdpZHRoOiA1MDAgfSk7XG4gIGRpYWxvZy5yZW5kZXIodHJ1ZSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcmVwYXJlRGFtYWdlUm9sbChyb2xsRGF0YTogUm9sbERhdGEpIHtcbiAgY29uc3QgaHRtbCA9IGF3YWl0IHJlbmRlclRlbXBsYXRlKFwic3lzdGVtcy93cmF0aC1hbmQtZ2xvcnkvdGVtcGxhdGUvZGlhbG9nL2RhbWFnZS1yb2xsLmh0bWxcIiwgcm9sbERhdGEpO1xuICBsZXQgZGlhbG9nID0gbmV3IERpYWxvZyh7XG4gICAgdGl0bGU6IHJvbGxEYXRhLm5hbWUsXG4gICAgY29udGVudDogaHRtbCxcbiAgICBidXR0b25zOiB7XG4gICAgICBjYW5jZWw6IHtcbiAgICAgICAgaWNvbjogJzxpIGNsYXNzPVwiZmFzIGZhLXRpbWVzXCI+PC9pPicsXG4gICAgICAgIGxhYmVsOiBnYW1lLmkxOG4ubG9jYWxpemUoXCJCVVRUT04uQ0FOQ0VMXCIpLFxuICAgICAgICBjYWxsYmFjazogKCkgPT4geyB9LFxuICAgICAgfSxcbiAgICAgIHJvbGw6IHtcbiAgICAgICAgaWNvbjogJzxpIGNsYXNzPVwiZmFzIGZhLWNoZWNrXCI+PC9pPicsXG4gICAgICAgIGxhYmVsOiBnYW1lLmkxOG4ubG9jYWxpemUoXCJCVVRUT04uUk9MTFwiKSxcbiAgICAgICAgY2FsbGJhY2s6IGFzeW5jIChodG1sOiBIdG1sKSA9PiB7XG4gICAgICAgICAgcm9sbERhdGEubmFtZSA9IGdhbWUuaTE4bi5sb2NhbGl6ZShyb2xsRGF0YS5uYW1lKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uZGFtYWdlLmJhc2UgPSBwYXJzZUludChodG1sLmZpbmQoXCIjZGFtYWdlLWJhc2VcIilbMF0udmFsdWUsIDEwKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uZGFtYWdlLmJvbnVzID0gcGFyc2VJbnQoaHRtbC5maW5kKFwiI2RhbWFnZS1ib251c1wiKVswXS52YWx1ZSwgMTApO1xuICAgICAgICAgIHJvbGxEYXRhLndlYXBvbi5kYW1hZ2UuYm9udXMgKz0gZ2V0UmFuayhyb2xsRGF0YSwgaHRtbC5maW5kKFwiI2RhbWFnZS1yYW5rXCIpWzBdLnZhbHVlKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uZWQuYmFzZSA9IHBhcnNlSW50KGh0bWwuZmluZChcIiNlZC1iYXNlXCIpWzBdLnZhbHVlLCAxMCk7XG4gICAgICAgICAgcm9sbERhdGEud2VhcG9uLmVkLmJvbnVzID0gcGFyc2VJbnQoaHRtbC5maW5kKFwiI2RhbWFnZS1ib251c1wiKVswXS52YWx1ZSwgMTApO1xuICAgICAgICAgIHJvbGxEYXRhLndlYXBvbi5lZC5ib251cyArPSBnZXRSYW5rKHJvbGxEYXRhLCBodG1sLmZpbmQoXCIjZGFtYWdlLXJhbmtcIilbMF0udmFsdWUpO1xuICAgICAgICAgIHJvbGxEYXRhLndlYXBvbi5hcC5iYXNlID0gcGFyc2VJbnQoaHRtbC5maW5kKFwiI2FwLWJhc2VcIilbMF0udmFsdWUsIDEwKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uYXAuYm9udXMgPSBwYXJzZUludChodG1sLmZpbmQoXCIjYXAtYm9udXNcIilbMF0udmFsdWUsIDEwKTtcbiAgICAgICAgICByb2xsRGF0YS53ZWFwb24uYXAuYm9udXMgKz0gZ2V0UmFuayhyb2xsRGF0YSwgaHRtbC5maW5kKFwiI2FwLXJhbmtcIilbMF0udmFsdWUpO1xuICAgICAgICAgIHJvbGxEYXRhLndlYXBvbi50cmFpdHMgPSBodG1sLmZpbmQoXCIjdHJhaXRzXCIpWzBdLnZhbHVlO1xuICAgICAgICAgIGF3YWl0IGRhbWFnZVJvbGwocm9sbERhdGEpO1xuICAgICAgICB9LFxuICAgICAgfVxuICAgIH0sXG4gICAgZGVmYXVsdDogXCJyb2xsXCIsXG4gICAgY2xvc2U6ICgpID0+IHsgfSxcbiAgfSwgeyB3aWR0aDogMjYwIH0pO1xuICBkaWFsb2cucmVuZGVyKHRydWUpO1xufVxuXG5mdW5jdGlvbiBfZ2V0VGFyZ2V0RGVmZW5zZShjb21iYXQ6IHZvaWQpIHtcbiAgY29uc3QgdGFyZ2V0ID0gZ2FtZS51c2VyLnRhcmdldHMudmFsdWVzKCkubmV4dCgpLnZhbHVlO1xuICBpZiAodGFyZ2V0ID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gMztcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gdGFyZ2V0LmFjdG9yLmNvbWJhdC5kZWZlbnNlLnRvdGFsO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldFJhbmsocm9sbERhdGE6IFJvbGxEYXRhLCByYW5rOiBzdHJpbmcpOiBudW1iZXIge1xuICBzd2l0Y2ggKHJhbmspIHtcbiAgICBjYXNlIFwibm9uZVwiOlxuICAgICAgcmV0dXJuIDA7XG4gICAgY2FzZSBcInNpbmdsZVwiOlxuICAgICAgcmV0dXJuIHJvbGxEYXRhLnJhbms7XG4gICAgY2FzZSBcImRvdWJsZVwiOlxuICAgICAgcmV0dXJuIChyb2xsRGF0YS5yYW5rICogMik7XG4gICAgICBjYXNlIFwibWludXMtc2luZ2xlXCI6XG4gICAgICByZXR1cm4gcm9sbERhdGEucmFuaztcbiAgICBjYXNlIFwibWludXMtZG91YmxlXCI6XG4gICAgICByZXR1cm4gKHJvbGxEYXRhLnJhbmsgKiAyKTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIDA7XG4gIH1cbn0iXX0=